<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Add your head content here -->
  <title>My Profile</title>
  <!-- Add your stylesheets and other head elements here -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>

<body>

  <!-- Your navigation bar or header section goes here -->

  <section class="profile-section">
    <div class="container">
      <div class="row">
        <div class="col-md-12 text-center">
          <h2>Hi, <span id="firstName"><%= user.firstName %></span> <span id="lastName"><%= user.lastName %></span></h2>
        </div>
      </div>

      <a href="/contributorHomepage">Back to Home</a>

      <!-- Display user details -->
      <div class="row mt-3">
        <div class="col-md-6">
          <h4>User Details:</h4>
          <p><strong>First Name:</strong><span id="firstName"><%= user.firstName %></span></p>
          <p><strong>Last Name:</strong> <span id="lastName"><%= user.lastName %></span></p>
          <p><strong>Gender:</strong> <span id="gender"><%= user.gender %></span></p>
          <p><strong>Birthdate:</strong> <%= user.bdate %></p>
          <p><strong>Email:</strong> <span id="email"><%= user.email %></span></p>
        </div>
        <div class="col-md-6">
          <h4>Additional Information:</h4>
          <p><strong>Address:</strong> <span id="address"><%= user.address %></span></p>
          <p><strong>User Type:</strong> <%= user.userType %></p>
          <p><strong>Specialty:</strong> <span id="specialty"><%= user.specialty %></span></p>
          <p><strong>Status:</strong> <span id="status"><%= user.status %></span></p>
        </div>
      </div>

      <!-- Button to open edit modal -->
      <button class="btn btn-primary mt-3" data-toggle="modal" data-target="#editProfileModal">Edit Profile</button>

      <!-- Modal for updating user information -->
      <div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <form id="updateProfileForm" action="/updateProfile" method="post">
                <div class="form-group">
                  <label for="newFirstname">First Name:</label>
                  <input type="text" class="form-control" id="firstName" name="firstName" value="<%= user.firstName %>" required>
                </div>
                <div class="form-group">
                  <label for="newLastName">Last Name:</label>
                  <input type="text" class="form-control" id="lastName" name="lastName" value="<%= user.lastName %>" required>
                </div>
                <!-- Replace the current gender input field with this dropdown -->
                <div class="form-group">
                  <label for="newGender">Gender:</label>
                  <select class="form-control" id="newGender" name="gender" required>
                    <option value="select" disabled>Select Gender</option>
                    <option value="Male" <%= user.gender === 'Male' ? 'selected' : '' %>>Male</option>
                    <option value="Female" <%= user.gender === 'Female' ? 'selected' : '' %>>Female</option>
                    <!-- Add more options as needed -->
                  </select>
                </div>

                <div class="form-group">
                  <label for="newEmail">Email:</label>
                  <input type="text" class="form-control" id="newEmail" name="email" value="<%= user.email %>" required>
                </div>
                <div class="form-group">
                  <label for="newAddress">Address:</label>
                  <input type="text" class="form-control" id="newAddress" name="address" value="<%= user.address %>" required>
                </div>
                <div class="form-group">
                  <label for="newSpecialty">Specialty:</label>
                  <input type="text" class="form-control" id="newSpecialty" name="specialty" value="<%= user.specialty %>" required>
                </div>
                <!-- Add other fields here -->
                <button type="submit" class="btn btn-primary">Update</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Your footer section goes here -->

      <!-- Include jQuery and Bootstrap JS at the end of the body for proper functioning -->
      <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

      <script>
       $(document).ready(function () {
  $('#updateProfileForm').submit(function (e) {
    e.preventDefault();

    var form = $(this);
    var modal = $('#editProfileModal');
    $.ajax({
      url: '/updateProfile',
      method: 'POST',
      data: form.serialize(),
      cache: false,
      success: function (data) {
        console.log('Update successful:', data);

        // Update the DOM with the received data
        $('#firstName').text(data.user.firstName);
$('#lastName').text(data.user.lastName);

        $('#gender').text(data.user.gender);
        $('#email').text(data.user.email);
        $('#address').text(data.user.address);
        $('#specialty').text(data.user.specialty);

        // Close the modal 
        modal.modal('hide');

        form.trigger('reset');
      },
      error: function (error) {
        console.error('Update failed:', error);
        // Handle errors
      },
    });
  });
});

      </script>
    </body>

    </html>
