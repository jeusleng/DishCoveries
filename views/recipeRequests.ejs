<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>Admin Page</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- DataTables CSS -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.css">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
  <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
  <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
  <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- MDB -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.1.0/mdb.min.css" rel="stylesheet" />

</head>
<style>
  .ellipsis {
    max-width: 200px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>
</head>

<body>

  <%- include("./section/sidebar.ejs") %>

  <main id="main" class="main">
    <!-- Modal -->
    <!-- ... Existing code ... -->
    <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="viewModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="viewModalLabel">View Recipe Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="card shadow p-3 mb-5 bg-white rounded" style="border-radius: 10px !important;">
              <div class="row" style="margin-bottom: -40px;">
                <!-- Circular image on the left -->
                <div class="col-md-4 text-center">
                  <div style="width: 250px; height: 250px; overflow: hidden; margin: 0 auto;">
                    <img id="recipeImage" class="menu-img img-fluid" style="width: 200px; height: 200px; border-radius: 10px; object-fit: cover;">
                  </div>
                </div>
                <!-- Recipe details on the right -->
                <div class="col-md-8" style="margin-bottom: 20px;">
                  <div class="recipe-details">
                    <p><strong>Recipe Name:</strong> <span id="recipeName"></span></p>
                    <p><strong>Cuisine:</strong> <span id="cuisine"></span></p>
                    <p><strong>Category:</strong> <span id="category"></span></p>
                    <p><strong>Status:</strong> <span id="status"></span></p>
                    <p id="rejectReasonContainer" style="display: none;"><strong>Reject Reason:</strong>
                      <span id="rejectReason"></span>
                    </p>
                    <p>
                      <i class="fa fa-cutlery"></i> <span id="servings"></span>
                      <i class="fa fa-clock-o"></i> <span id="cookTime"></span>
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <div class="row mt-4">
              <div class="col-md-12">
                <h3>Description</h3>
                <span id="description"></span></p>
              </div>
            </div>

            <!-- Ingredients and instructions below -->
            <div class="row mt-4">
              <div class="col-md-12">
                <h3>Ingredients</h3>
                <ul id="ingredients" class="list-unstyled"></ul>
              </div>
            </div>
            <div class="row mt-4">
              <div class="col-md-12">
                <h3>Instructions</h3>
                <ol id="instructions" class="list-unstyled"></ol>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>



    <div class="pagetitle">
      <h1>Recipe Requests</h1>
      <!-- <nav>
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                    <li class="breadcrumb-item ">Dashboard</li>
                </ol>
            </nav> -->
    </div><!-- End Page Title -->

    <section>

      <% if (successMessages && successMessages.length > 0) { %>
      <div class="alert alert-success" role="alert">
        <%= successMessages[0] %>
      </div>
      <% } %>

      <div class="card p-5 mt-3">
        <div class="card-body">
          <table id="myTable" class="display">
            <thead>
              <tr>
                <th>#</th>
                <th>Contributor's Name</th>
                <th>Recipe Name</th>
                <th>Cuisine</th>
                <th>Status</th>
                <!-- <th>Preparation Time</th>
                        <th>Cook Time</th>
                        <th>Servings</th>
                        <th>Difficulty</th> -->
                <th>Action</th>
                <!-- Add your desired columns here -->
              </tr>
            </thead>
            <tbody>
              <% let counter=1; %>
              <% recipes.forEach(recipe=> {%>
              <tr>
                <td>
                  <%= counter %>
                </td>
                <td>
                  <% if (recipe.firstName && recipe.lastName) { %>
                  <%= recipe.firstName + ' ' + recipe.lastName %>
                  <% } else { %>
                  N/A
                  <% } %>
                </td>

                <td>
                  <%= recipe.recipeName %>
                </td>
                <td>
                  <%= recipe.cuisine %>
                </td>

                <td>
                  <span class="badge badge-<%= recipe.status === 'approved' ? 'success' : (recipe.status === 'pending' ? 'warning' : 'danger') %> rounded-pill d-inline">
                    <%= recipe.status.charAt(0).toUpperCase() + recipe.status.slice(1) %>
                  </span>
                </td>
                <td>
                  <div class="dropdown">
                    <button class="btn btn-secondary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                      Action
                    </button>

                    <ul class="dropdown-menu">
                      <li>
                        <!-- ... Existing code ... -->
                        <button type="button" class="dropdown-item viewModal" data-bs-toggle="modal" data-bs-target="#viewModal" data-recipe-name="<%= recipe.recipeName %>" data-cuisine="<%= recipe.cuisine %>" data-category="<%= recipe.category %>" data-description="<%= recipe.recipeDescription %>" data-ingredients="<%= recipe.ingredients %>" data-instructions="<%= recipe.instructions %>" data-image="/uploads/<%= recipe.recipeImage %>" data-status="<%= recipe.status %>" data-reject-reason="<%= recipe.rejectReason || '' %>">
                          <!-- Use an empty string if rejectReason is undefined -->
                          View
                        </button>

                      </li>

                      <li>
                        <form action="/recipes/approve/<%= recipe.id %>" method="post">
                          <button type="submit" class="dropdown-item text-success">Approve</button>
                        </form>
                      </li>
                      <li>
                        <form id="rejectForm" action="/recipes/reject/<%= recipe.id %>" method="post" enctype="multipart/form-data">
                          <button type="submit" class="dropdown-item reject-btn text-danger">Reject</button>
                        </form>
                      </li>

                    </ul>
                  </div>
              </tr>
              <% counter++; %>
              <% }); %>
            </tbody>
          </table>
        </div>
      </div>
    </section>
    <script type="text/javascript">
      $(document).ready(function() {
        $('.dropdown-item.reject-btn').click(function(event) {
          event.preventDefault();


          // Create a Bootstrap modal
          var modal = `<div class="modal fade" id="rejectModal" tabindex="-1" aria-labelledby="rejectModalLabel" aria-hidden="true">

      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="rejectModalLabel">Enter Reject Reason</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <label for="rejectReasonInput" class="form-label">Reject Reason:</label>
<input type="text" id="rejectReasonInput" name="rejectReason" class="form-control">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" id="submitRejectReason">Submit</button>
          </div>
        </div>
      </div>
    </div>
  `;

          // Append the modal to the body
          $('body').append(modal);

          // Show the modal
          $('#rejectModal').modal('show');

          // Handle submit button click
    $('#submitRejectReason').click(function() {
        // Get the reject reason from the input field
        var rejectReason = $('#rejectReasonInput').val();

        // If the reject reason is not empty, proceed with the form submission
        if (rejectReason.trim() !== '') {
            // Disable the button to prevent multiple submissions
            $(this).prop('disabled', true);

            // Append the reject reason as a hidden input
            var form = $(event.target).closest('form');
            $('<input>').attr({
                type: 'hidden',
                name: 'rejectReason',
                value: rejectReason
            }).appendTo(form);
            console.log('Form Data:', form.serialize());

            // Submit the form
            form.submit();

            // Close the modal
            $('#rejectModal').modal('hide');
        } else {
            alert('Please enter a reject reason.'); // You can customize this alert
        }
        

    });
        });


        $('#myTable').DataTable();

        $('#viewModal').on('show.bs.modal', function(event) {
          var button = $(event.relatedTarget);
          var recipeName = button.data('recipe-name');
          var cuisine = button.data('cuisine');
          var category = button.data('category');
          var description = button.data('description');
          var ingredientsString = button.data('ingredients');
          var instructionsString = button.data('instructions');
          var image = button.data('image');
          var status = button.data('status');
          var rejectReason = button.data('reject-reason');

          var ingredients = ingredientsString ? ingredientsString.split(',').map(ingredient => ingredient.trim()) : [];
          var instructions = instructionsString ? instructionsString.split('.,').map(instruction => instruction.trim()) : [];

          var modal = $(this);
          modal.find('.modal-title').text('Recipe Details');
          modal.find('#recipeName').text(recipeName);
          modal.find('#cuisine').text(cuisine);
          modal.find('#category').text(category);
          modal.find('#description').text(description);
          modal.find('#recipeImage').attr('src', image);
          modal.find('#status').text(status);

          // Display reject reason if status is 'rejected'
          if (status === 'rejected') {
            modal.find('#rejectReasonContainer').show();
            modal.find('#rejectReason').text(rejectReason);
          } else {
            modal.find('#rejectReasonContainer').hide();
          }

          var servings = button.data('servings');
          var cookTime = button.data('cook-time');

          modal.find('#servings').text(servings);
          modal.find('#cookTime').text(cookTime);

          // Display ingredients in an unordered list
          var ingredientsHtml = '<ul>';
          ingredients.forEach(function(ingredient, index) {
            ingredientsHtml += '<li>' + ingredient + '</li>';
          });
          ingredientsHtml += '</ul>';
          modal.find('#ingredients').html(ingredientsHtml);

          // Display instructions in an ordered list
          var instructionsHtml = '<ol>';
          instructions.forEach(function(instruction, index) {
            instructionsHtml += '<li>' + instruction + '</li>';
          });
          instructionsHtml += '</ol>';
          modal.find('#instructions').html(instructionsHtml);
        });
      });
    </script>


    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    <script type="text/javascript">
      $(document).ready(function() {
        $('#myTable').DataTable();
      });
    </script>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer" class="footer">
    <div class="copyright">
      &copy; Copyright <strong><span>DishCoveries</span></strong>. All Rights Reserved
    </div>
    <div class="credits">Designed by <a href="">Pabebe Ghurls</a>
    </div>
  </footer><!-- End Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/chart.js/chart.umd.js"></script>
  <script src="assets/vendor/echarts/echarts.min.js"></script>
  <script src="assets/vendor/quill/quill.min.js"></script>
  <script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
  <script src="assets/vendor/tinymce/tinymce.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>

  <!-- Template Main JS File -->
  <script src="assets/js/main.js"></script>

</body>

</html>